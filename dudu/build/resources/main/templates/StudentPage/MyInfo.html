<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 정보</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* 모달 창 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            max-height: 70vh;
            overflow-y: auto; /* 세로 스크롤 활성화 */
            border-radius: 8px;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover, .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>내 정보</h1>
<p>학생 ID: <span th:text="${dto.studentId}" id="studentId">학생 ID 없음</span></p>
<p>학생 이름: <span th:text="${dto.studentName}">학생 이름 없음</span></p>
<p>소속: <span th:text="${dto.department}">소속 없음</span></p>

<!-- 예약 조회 버튼 추가 -->
<button id="loadReservationBtn">예약 조회</button>

<!-- 모달 창 추가 -->
<div id="reservationModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>예약 목록</h2>
        <div id="reservationContainer">예약 내역이 없습니다.</div>
    </div>
</div>

<script>
    $(document).ready(function() {
        const modal = $('#reservationModal');
        const modalContent = $('#reservationContainer');

        // 예약 버튼 클릭 시
        $('#loadReservationBtn').click(function() {
            const studentId = $('#studentId').text().trim();

            // 예약 정보를 가져오는 AJAX 요청
            $.ajax({
                url: '/search/reservation', // 예약 정보 조회 API
                method: 'GET',
                data: { 'student-id': studentId },
                success: function(data) {
                    let reservationsHTML = '';

                    if (data.content.length === 0) {
                        reservationsHTML = '<p>예약 내역이 없습니다.</p>';
                    } else {
                        data.content.forEach(function(reservation) {
                            reservationsHTML += `
                                <p>예약 시작 시간: ${new Date(reservation.reservationStartTime).toLocaleString()}</p>
                                <p>예약 종료 시간: ${new Date(reservation.reservationEndTime).toLocaleString()}</p>
                                <p>예약 타입: ${reservation.reservationType}</p>
                                <hr />
                            `;
                        });
                    }

                    modalContent.html(reservationsHTML); // 예약 정보 업데이트
                    modal.show(); // 모달 창 열기
                },
                error: function() {
                    alert('예약 정보를 불러오는 데 실패했습니다.');
                }
            });
        });

        // 닫기 버튼 클릭 시
        $('.close-btn').click(function() {
            modal.hide(); // 모달 창 닫기
        });

        // 모달 창 외부 클릭 시 닫기
        $(window).click(function(event) {
            if ($(event.target).is(modal)) {
                modal.hide();
            }
        });
    });
</script>
</body>
</html>
